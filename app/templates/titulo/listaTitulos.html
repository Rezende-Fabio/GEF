{% extends "public/base.html" %}
{% block conteudo %}
{% include "public/modal/modalVisualizacao.html" %}
    {% include "public/header.html" %}
    <!-- Exibe mensagem que foi enviado pelo Back -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <script>
                    window.setTimeout(function() {
                        $(".alert").fadeTo(500, 0).slideUp(500, function(){
                            $(this).remove(); 
                        });
                    }, 8000);
                </script>
                <div class="alert alert-{{ category }} d-flex align-items-center" role="alert">
                    {% if category == "success" %}
                        <i class="fa-solid fa-circle-check"></i>
                    {% else %}
                        <i class="fa-solid fa-circle-exclamation"></i>
                    {% endif %}
                    <h6>{{ message }}</h6>
                    <div class="progress active"></div>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="conteiner-fluid d-flex justify-content-end">
        <a class="btn btn-success" href="{{ url_for('tituloBlue.cadTitulo') }}">Cadastrar Título</a>
    </div>
    <div id="lista-titulos"></div>

    <!-- Modal de confrimação de exclusão do título -->
    {% if context %}
        {% if context.aviso == 1 %}
            <section class="modal-delete">
                <div id="card-delete">
                    <h2>Aviso!</h2>
                    <hr>
                    <p>Deseja mesmo excluir o título {{ context.titulo.t_numDoc }}?</p>
                    <div id="btns">
                        <a class="btn btn-success btn-sm" href="/deletar-titulo/{{ context.titulo.t_numDoc }}">Confirmar</a>
                        <a class="btn btn-danger btn-sm" href="javascript:history.back()">Cancelar</a>
                    </div>
                </div>
            </section>
        {% endif %}
    {% endif %}
{% endblock %}
{% block script %} 
<script type="text/javascript" src="{{ url_for('static', filename='js/titulo/dataTi.js') }}"></script>
<script>
    new gridjs.Grid({
        columns: columnsTi,
        data: () => {
            return new Promise(resolve => {
                setTimeout(() => resolve(dataTi), 2000);
            });
        },
        search: {
            ignoreHiddenColumns: false,
        },
        sort: true,
        paginationAutoPageSize: true,
        pagination: true,
        style: {
            td: {
                'font-size': '13.5px'
            }
        },
    }).render(document.getElementById("lista-titulos"));
</script>

<script>
    $(document).ready(function() {

        $('#modalVisu').on('show.bs.modal', function (event) {
            var modal = $(this);
            var idDoElementoClicado = modal.data('id');
            
            $.ajax({
                url: `/lista-titulos/view/${idDoElementoClicado}`,
                type: 'GET',
                success: function(data) {
                    $('#corpoModalVisu').html("");
                    $('#corpoModalVisu').html(data);
                }
            });
        });
    });
</script>

<script type="text/javascript">
    $(document).on('click', '.abrirModal', function() {
        var idDoElementoClicado = $(this).data('id');
        $('#modalVisu').data('id', idDoElementoClicado);
        $('#modalVisu').modal('show');
    });
</script>
{% endblock %}